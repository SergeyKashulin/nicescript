<html>
  <head>
    <title>Ball game example</title>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <script src="../nice.js"></script>
  </head>
  <body style="margin:0">
<script>
var ball = nice.Object()
  .Number('x')
  .Number('dx', z => z(2))
  .Number('y')
  .Number('dy', z => z(2))
  .Number('size', z => z(20));
var platform = nice.Object()
  .Number('x')
  .Number('height', z => z(20))
  .Number('width', z => z(60));


nice.Div().by(z => {
  var size = z.use(ball.size)();
  z.position('absolute')
    .width(size + 'px')
    .height(size + 'px')
    .borderRadius(size / 2 + 'px')
    .background('radial-gradient(circle at 30% 30%, #5cabff, #000)')
    .top(z.use(ball.y)() + 'px').left(z.use(ball.x)() + 'px');
}).show();

function move() {
  ball.x() + ball.size() > window.innerWidth && ball.dx(-2);
  ball.x() < 0 && ball.dx(2);
  if(ball.y() + ball.size() + platform.height() > window.innerHeight) {
    if(!ball.x.between(platform.x(), platform.x() + platform.width())){
      return nice.H1('You lose!').color('red').textAlign('center')
          .position('absolute').width('100%').top('45%').show();
    }
    ball.dy(-2);
  } 
  ball.y() < 0 && ball.dy(2);
  
  ball.x.inc(ball.dx());
  ball.y.inc(ball.dy());
  setTimeout(move, 10);
}
move();


nice.Div().by(z => {
  var size = z.use(platform.width)();
  z.position('absolute')
    .width(size + 'px')
    .height(platform.height() + 'px')
    .borderRadius(size / 2 + 'px')
    .background('linear-gradient(#333, #777 25%, #000)')
    .bottom(0).left(z.use(platform.x)() + 'px');
}).show();

window.addEventListener('mousemove', e => {
  var x = e.clientX - platform.width() / 2;
  var max = document.body.offsetWidth - platform.width() - 1;
  
  platform.x(Math.max(0, Math.min(x, max)));
});

</script>
  </body>
</html>
